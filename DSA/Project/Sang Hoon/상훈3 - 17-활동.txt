PROC SQL;
CREATE TABLE TEST AS
SELECT *, COUNT(DISTINCT SALE_DATE) AS 구매횟수, SUM(BUY_AMT) AS 구매금액, (SUM(BUY_AMT)/COUNT(DISTINCT SALE_DATE)) AS 객단가
FROM DSAB.CLIENT17_3
GROUP BY CLIENT_NO
HAVING SALE_DATE IS NOT NULL
;
QUIT;


PROC SQL;
CREATE TABLE TEST2 AS
SELECT DISTINCT CLIENT_NO, 구매횟수, 구매금액, ROUND(객단가) AS 객단가
FROM TEST
;
QUIT;


PROC SQL;
CREATE TABLE TEST3 AS
SELECT *, CASE WHEN 1 <  구매횟수 <= 4 THEN "C"
						WHEN 4 < 구매횟수 <= 11 THEN "B"
						WHEN 11 < 구매횟수 <= 47 THEN "A"
						WHEN 47 < 구매횟수 <= 95 THEN "S"
						WHEN 95 < 구매횟수 THEN "SS"
						WHEN 구매횟수 <= 1 THEN "F"
					END AS 구매등급
FROM TEST2
;
QUIT;

PROC UNIVARIATE DATA=TEST2 PLOT;
VAR 구매횟수;
HISTOGRAM;
RUN;

PROC SQL;
SELECT 구매등급, COUNT(DISTINCT CLIENT_NO)
FROM TEST3
GROUP BY 구매등급
;
QUIT;

PROC SQL;
CREATE TABLE TEST4 AS
SELECT *
FROM TEST3
WHERE CLIENT_NO NOT IN ("M15120257","M16090139","M16020070") AND 구매금액 > 0
;
QUIT;

PROC SQL;
SELECT 구매등급, COUNT(DISTINCT CLIENT_NO)
FROM TEST4
GROUP BY 구매등급
;
QUIT;


